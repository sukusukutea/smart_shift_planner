<%# locals:
  date:, in_month:, occupation:, row_key:, shift_month:,
  day_enabled_by_date:, required_by_date:,
  holiday_requests_by_date:, designations_by_date:
%>

<% if row_key == :req %>
  <% day_on = day_enabled_by_date[date] %>

  <% if day_on %>
    <% req = required_by_date[date] || { nurse: 0, care: 0 } %>
    <div class="req-count text-muted">
      日勤 看護:<%= req[:nurse] %> 介護:<%= req[:care] %>
    </div>
  <% else %>
    <div class="req-count text-muted">日勤 -</div>
  <% end %>

<% else %>
  <div class="day-slots">
    <div class="slot slot-day" data-shift-kind="day">
      <% desig_day = designations_by_date.dig(date, "day") %>
      <% if desig_day.present? && row_key_for(desig_day.staff) == row_key %>
        <div class="small shift-line"><%= desig_day.staff.last_name %></div>
      <% end %>

      <% desig_day = designations_by_date.dig(date, "early") %>
      <% if desig_day.present? && row_key_for(desig_day.staff) == row_key %>
        <div class="small shift-line"><%= desig_day.staff.last_name %><span class="shift-time">730-1630</div>
      <% end %>

      <% desig_day = designations_by_date.dig(date, "late") %>
      <% if desig_day.present? && row_key_for(desig_day.staff) == row_key %>
        <div class="small shift-line"><%= desig_day.staff.last_name %><span class="shift-time">11-12</div>
      <% end %>

      <% requests = holiday_requests_by_date[date] || [] %>
      <% requests.each do |request| %>
        <% if row_key_for(request.staff) == occupation[:key] %>
          <div class="holiday-in-slot"><%= "#{request.staff.last_name} 休" %></div>
        <% end %>
      <% end %>
    </div>

    <div class="slot slot-night" data-shift-kind="night">
      <% desig_night = designations_by_date.dig(date, "night") %>
      <% if desig_night.present? && row_key_for(desig_night.staff) == row_key %>
        <div class="small shift-line"><%= desig_night.staff.last_name %></div>
      <% end %>
    </div>

    <div class="slot slot-stay" data-shift-kind="stay"></div>
  </div>
<% end %>
